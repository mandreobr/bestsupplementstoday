---
import { getCollection } from 'astro:content';
import { CATEGORY_CONFIG } from '../../config/categories';

// 1) Gerar todos os caminhos estáticos para as categorias
export async function getStaticPaths() {
  const paths = Object.values(CATEGORY_CONFIG).map((config) => ({
    params: { slug: config.slug }
  }));

  return paths;
}

// 2) Carregar todos os reviews
const reviews = await getCollection('reviews');

// 3) Ler o slug da URL e encontrar a categoria correspondente
const { slug } = Astro.params;

const entries = Object.entries(CATEGORY_CONFIG);
const match = entries.find(([_, cfg]) => cfg.slug === slug);

if (!match) {
  throw new Error(`Category not found for slug: ${slug}`);
}

const [categoryLabel, categoryConfig] = match;

// 4) Filtrar reviews dessa categoria
const categoryReviews = reviews.filter(
  (r) => r.data.category === categoryLabel
);
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{categoryLabel} — Supplement Reviews | Best Supplements Today</title>
    <meta name="description" content={categoryConfig.description} />
    <meta
      name="robots"
      content={categoryReviews.length === 0 ? 'noindex,follow' : 'index,follow'}
    />
  </head>

  <body class="bg-slate-100 text-slate-900">
    <main class="max-w-6xl mx-auto px-4 pb-20">
      <header class="pt-10 pb-6">
        <a href="/" class="text-xs text-b
